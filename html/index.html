<html>
<body>
	<div>
		<h1>input</h1>
		<label>
			Tries
			<input id="tries" type="text" />
		</label>
		<label>
			Multiple
			<input id="multiple" type="text" />
		</label>
	</div>
	<div>
		<h1>http</h1>
		<button onclick="http_start()">Start</button>
		<div id="http_duration"></div>
	</div>
	<div>
		<h1>ws</h1>
		<button onclick="ws_start()">Start</button>
		<div id="ws_duration"></div>
	</div>
</body>
<script>
var $http_duration = document.querySelector("#http_duration");
var $ws_duration = document.querySelector("#ws_duration");
var $tries = document.querySelector("#tries");
var $multiple = document.querySelector("#multiple");

var tries = "100";
var multiple = "100000";

$tries.value = tries;
$multiple.value = multiple;
$tries.addEventListener("change", (e) => tries = e.target.value);
$multiple.addEventListener("change", (e) => multiple = e.target.value);

async function http_start() {
	http_duration.innerHTML = "";
	startTime = performance.now();

	for (i = 0; i < tries; i++) {
		let response = await fetch(`/api/block?multiple=${multiple}`);
		let text = await response.text(); // read in the data
	}

	endTime = performance.now();
	http_duration.innerHTML = `Finished ${tries} tries in ${endTime - startTime} milliseconds`;
}

async function ws_start() {
	let ws_receives = 0;
	$ws_duration.innerHTML = "";

	let socket = new WebSocket("ws://localhost:8000/api/ws");

	socket.onopen = () => {
		console.log("connected");
		startTime = performance.now();
		socket.send(multiple);
	}

	socket.onmessage = (e) => {
		ws_receives++;
		let text = e.data; // read in the data
		if (ws_receives < tries) {
			socket.send(multiple);
			return;
		}
		endTime = performance.now();
		$ws_duration.innerHTML = `Finished ${tries} in ${endTime - startTime} milliseconds`;
		socket.close();
	}
}
</script>
</html>
